cmake_minimum_required(VERSION 3.20)

project(
	Dev
	VERSION 0.1.0
	DESCRIPTION "Lightweight CLI Dispatcher"
	LANGUAGES CXX
)

set(AUTHOR     "zuudevs")
set(EMAIL      "zuudevs@gmail.com")
set(REPOSITORY "https://github.com/zuudevs/dev")

# ── C++ Standard ──────────────────────────────────────────────
set(CMAKE_CXX_STANDARD 23)
set(CMAKE_CXX_STANDARD_REQUIRED ON)
set(CMAKE_CXX_EXTENSIONS OFF)

# ── Output Directories ───────────────────────────────────────
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/lib)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_SOURCE_DIR}/lib)

# ── Generate version header ──────────────────────────────────
configure_file(
	${CMAKE_SOURCE_DIR}/include/dev/version.hpp.in
	${CMAKE_BINARY_DIR}/include/dev/version.hpp
	@ONLY
)

# ── Executable ────────────────────────────────────────────────
add_executable(${PROJECT_NAME}
	src/main.cpp
)

# ── Compiler Warnings ────────────────────────────────────────
if(MSVC)
	target_compile_options(${PROJECT_NAME} PRIVATE
		/W4
		/permissive-
		/utf-8
	)
else()
	target_compile_options(${PROJECT_NAME} PRIVATE
		-Wall
		-Wextra
		-Wpedantic
		-Wconversion
		-Wshadow
	)
endif()

# ── Release Optimizations ────────────────────────────────────
if(CMAKE_BUILD_TYPE STREQUAL "Release")
	if(MSVC)
		target_compile_options(${PROJECT_NAME} PRIVATE /O2)
	else()
		target_compile_options(${PROJECT_NAME} PRIVATE -O3)
	endif()
endif()

# ── Include Directories ──────────────────────────────────────
target_include_directories(${PROJECT_NAME} PRIVATE
	${CMAKE_SOURCE_DIR}/include
	${CMAKE_BINARY_DIR}/include
)

# ── Build Info ────────────────────────────────────────────────
message(STATUS "")
message(STATUS "═══════════════════════════════════")
message(STATUS "  Project: ${PROJECT_NAME}")
message(STATUS "  Version: ${PROJECT_VERSION}")
message(STATUS "  Author:  ${AUTHOR}")
message(STATUS "  Build:   ${CMAKE_BUILD_TYPE}")
message(STATUS "  C++:     ${CMAKE_CXX_STANDARD}")
message(STATUS "═══════════════════════════════════")
message(STATUS "")

# ── Example Plugins ──────────────────────────────────────────
option(DEV_BUILD_EXAMPLES "Build example plugins" ON)

if(DEV_BUILD_EXAMPLES)
	set(PLUGIN_OUTPUT_DIR ${CMAKE_SOURCE_DIR}/plugins)
	file(MAKE_DIRECTORY ${PLUGIN_OUTPUT_DIR})

	# Helper: add a plugin target
	function(add_plugin NAME SOURCE)
		add_executable(${NAME} ${SOURCE})
		set_target_properties(${NAME} PROPERTIES
			RUNTIME_OUTPUT_DIRECTORY                ${PLUGIN_OUTPUT_DIR}
			RUNTIME_OUTPUT_DIRECTORY_DEBUG           ${PLUGIN_OUTPUT_DIR}
			RUNTIME_OUTPUT_DIRECTORY_RELEASE         ${PLUGIN_OUTPUT_DIR}
			RUNTIME_OUTPUT_DIRECTORY_RELWITHDEBINFO  ${PLUGIN_OUTPUT_DIR}
			RUNTIME_OUTPUT_DIRECTORY_MINSIZEREL      ${PLUGIN_OUTPUT_DIR}
			CXX_STANDARD 23
		)
	endfunction()

	add_plugin(hello   examples/hello.cpp)
	add_plugin(sysinfo examples/sysinfo.cpp)

	message(STATUS "  Plugins → ${PLUGIN_OUTPUT_DIR}")
endif()
